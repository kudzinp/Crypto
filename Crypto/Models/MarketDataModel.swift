//
//  MarketDataModel.swift
//  Crypto
//
//  Created by Pavel Kudin on 18/09/2025.
//

import Foundation

// JSON data:
/*
 
 URL: https://api.coingecko.com/api/v3/global

 JSON Response:
 {
    "data":{
       "active_cryptocurrencies":18826,
       "upcoming_icos":0,
       "ongoing_icos":49,
       "ended_icos":3376,
       "markets":1377,
       "total_market_cap":{
          "btc":35860011.000549205,
          "eth":917242530.7359744,
          "ltc":35582659712.26618,
          "bch":6612506156.094261,
          "bnb":4263362534.4826245,
          "eos":8650318548211.296,
          "xrp":1356190287031.6025,
          "xlm":10499639980219.227,
          "link":171966105887.39917,
          "dot":923775092060.9775,
          "yfi":759335465.3492891,
          "sol":16955399356.997223,
          "usd":4213235162406.302,
          "aed":15475212751518.346,
          "ars":6.21278516901535e+15,
          "aud":6372244322853.973,
          "bdt":513001360411423.06,
          "bhd":1588819406213.7412,
          "bmd":4213235162406.302,
          "brl":22413989740485.28,
          "cad":5812558163879.92,
          "chf":3340054814703.0835,
          "clp":4031686859258211.5,
          "cny":29966635092614.824,
          "czk":86809210786228.4,
          "dkk":26683741239360.1,
          "eur":3575064858826.944,
          "gbp":3109717248374.331,
          "gel":11375734938497.014,
          "hkd":32771069747591.516,
          "huf":1392474992197317.5,
          "idr":6.9817357059975176e+16,
          "ils":14093756140292.756,
          "inr":371595510559899.75,
          "jpy":623357170651112.5,
          "krw":5.849556856987998e+15,
          "kwd":1286144805381.635,
          "lkr":1273331346076318.5,
          "mmk":8.845687223472028e+15,
          "mxn":77434733057228.22,
          "myr":17678734741456.844,
          "ngn":6.300176935401015e+15,
          "nok":41620169691545.086,
          "nzd":7163051709896.986,
          "php":240977396547607.84,
          "pkr":1.186025698217374e+15,
          "pln":15236326531045.068,
          "rub":350833896878053.1,
          "sar":15802290410411.107,
          "sek":39411511767943.62,
          "sgd":5402732566397.496,
          "thb":134499106089496.36,
          "try":174010395692556.1,
          "twd":126847862608096.19,
          "uah":173939975680051.66,
          "vef":421871236811.743,
          "vnd":1.1116715467919309e+17,
          "zar":73086657516684.27,
          "xdr":2906504490021.15,
          "xag":100692528469.86444,
          "xau":1155311213.883432,
          "bits":35860011000549.2,
          "sats":3586001100054920.5
       },
       "total_volume":{
          "btc":1603602.312700268,
          "eth":41017618.30392992,
          "ltc":1591199606.8752687,
          "bch":295700694.6956909,
          "bnb":190650750.7783895,
          "eos":386828404187.97455,
          "xrp":60646659609.56373,
          "xlm":469527099546.67566,
          "link":7690049094.041524,
          "dot":41309743993.698135,
          "yfi":33956267.00535048,
          "sol":758218329.0802943,
          "usd":188409134907.44217,
          "aed":692026752515.035,
          "ars":277825811743068.3,
          "aud":284956569953.7372,
          "bdt":22940599989262.207,
          "bhd":71049461591.86626,
          "bmd":188409134907.44217,
          "brl":1002317756794.1014,
          "cad":259928300472.63257,
          "chf":149361906925.2795,
          "clp":180290585284280.38,
          "cny":1340059972029.1824,
          "czk":3881969003811.7646,
          "dkk":1193254211837.1921,
          "eur":159871180061.2817,
          "gbp":139061579519.88965,
          "gel":508704664250.0938,
          "hkd":1465469802451.9485,
          "huf":62269253565781.32,
          "idr":3122120493668613.5,
          "ils":630250223315.9084,
          "inr":16617156645985.578,
          "jpy":27875535243954.895,
          "krw":261582822827187.72,
          "kwd":57514337749.25052,
          "lkr":56941340351804.61,
          "mmk":395564978738174.75,
          "mxn":3462757359778.7607,
          "myr":790564730071.6273,
          "ngn":281733831701145.44,
          "nok":1861187392589.398,
          "nzd":320320210939.32446,
          "php":10776123588091.35,
          "pkr":53037171476444.97,
          "pln":681344142974.9178,
          "rub":15688730502583.422,
          "sar":706653142067.0345,
          "sek":1762419744297.3538,
          "sgd":241601555511.05078,
          "thb":6014584813650.275,
          "try":7781466463080.508,
          "twd":5672433447840.091,
          "uah":7778317392799.665,
          "vef":18865406678.282185,
          "vnd":4.971217279803184e+15,
          "zar":3268318378917.74,
          "xdr":129974230125.03389,
          "xag":4502808756.06645,
          "xau":51663668.88296971,
          "bits":1603602312700.268,
          "sats":160360231270026.8
       },
       "market_cap_percentage":{
          "btc":55.55700937779753,
          "eth":13.167130226440579,
          "xrp":4.41098207650336,
          "usdt":4.064756862762332,
          "bnb":3.267495859689315,
          "sol":3.205749661346704,
          "usdc":1.7597853692724683,
          "doge":1.0129938241461658,
          "steth":0.9376987296607872,
          "ada":0.8064041254639762
       },
       "market_cap_change_percentage_24h_usd":2.1639642491525404,
       "updated_at":1758225665
    }
 }
 
 */

struct GlobalData: Codable {
    let data: MarketDataModel?
}

struct MarketDataModel: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double
    
    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap: String {
        if let item = totalMarketCap.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var volume: String {
        if let item = totalVolume.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var btcDominance: String {
        if let item = marketCapPercentage.first(where: { $0.key == "btc" }) {
            return item.value.asPercentString()
        }
        return ""
    }
}
